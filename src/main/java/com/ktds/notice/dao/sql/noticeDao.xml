<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="NoticeDao">
			
	<resultMap type="NoticeVO" id="noticeResultMap">
		<id property="noticeId" column="NOTICE_ID" />
		<result column="RNUM" property="rnum"/>
		<result property="title" column="TITLE" />
		<result property="content" column="CONTENT" />
		<result property="regDate" column="REG_DATE" />
		<result property="viewCount" column="VIEWCOUNT" />
		<result property="email" column="B_EMAIL" />
		<association property="memberVO" javaType="MemberVO">
			<id property="email" column="M_EMAIL" />
			<result property="name" column="NAME" />
			<result property="password" column="PASSWORD" />
			<result property="salt" column="SALT" />
			<result property="loginFailCount" column="LOGIN_FAIL_COUNT" />
			<result property="lastLogin" column="LAST_LOGIN" />
			<result property="adminYN" column="ADMIN_YN" />
			<result property="approvalStatus" column="APPROVAL_STATUS" />
			<result property="phone" column="PHONE" />
		</association>
	</resultMap>
	

	<insert id="insertNotice" parameterType="NoticeVO">
		INSERT INTO NOTICE (
  							NOTICE_ID
  							, TITLE
  							, CONTENT
  							, REG_DATE
  							, VIEWCOUNT 							
  							, EMAIL
   						  ) 
		VALUES ( 			
					NEXTVALUE('NO',NOTICE_ID_SEQ.NEXTVAL)					
					, #{title}
					, #{content}
					, SYSDATE				
					, 0
					, #{email}
		)
	</insert>
	
	<select id="selectOneNotice" parameterType="_int" resultMap="noticeResultMap">
		SELECT	B.NOTICE_ID
  				, B.TITLE
  				, B.CONTENT
  				, B.REG_DATE
  				, B.VIEWCOUNT
  				, B.EMAIL B_EMAIL
  				, M.EMAIL M_EMAIL
  				, M.NAME
				, M.PASSWORD
				, M.SALT
				, M.LOGIN_FAIL_COUNT
				, M.LAST_LOGIN
				, M.ADMIN_YN
		FROM	NOTICE B
				, MEMBERS M
		WHERE	B.EMAIL = M.EMAIL
		AND		NOTICE_ID = #{noticeId}
	</select>

	<select id="selectAllNoticesCount" parameterType="NoticeSearchVO" resultType="_int">
		SELECT	COUNT(1)
		FROM	NOTICE
</select>

	<select id="selectAllNotices" parameterType="NoticeSearchVO" resultMap="noticeResultMap">
		SELECT	*
		FROM	(
					SELECT	A.*
							, ROWNUM RNUM
					FROM	(
								SELECT	B.NOTICE_ID
						  				, B.TITLE
						  				, B.CONTENT
						  				, B.REG_DATE
						  				, B.VIEWCOUNT
						  				, B.EMAIL B_EMAIL
						  				, M.EMAIL M_EMAIL
										, M.NAME
										, M.PASSWORD
										, M.SALT
										, M.LOGIN_FAIL_COUNT
										, M.LAST_LOGIN
										, M.ADMIN_YN
								FROM	NOTICE B
										, MEMBER M
								WHERE	B.EMAIL = M.EMAIL
								ORDER	BY NOTICE_ID DESC
							) A
					WHERE	ROWNUM <![CDATA[<=]]> #{endRow}
				)
		WHERE	RNUM >= #{startRow}
	</select>	
	
	<update id="modifyOneNotice" parameterType="noticeVO">
		UPDATE NOTICE
		SET		TITLE = #{title}
				, CONTENT = #{content}
				, REG_DATE = SYSDATE
		WHERE	NOTICE_ID = #{noticeId}
	
	</update>
	
	<delete id="deleteOneNotice" parameterType="_int">
		DELETE	NOTICE
		WHERE	ID = #{id}
	</delete>
		
</mapper>